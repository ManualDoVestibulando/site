{% extends "base.html.jinja" %}

{#
Depends on the variables

course_name:
  Name of the course being rendered
latest_metrics_plotly_div:
  Plotly string from latest metric table
metric_evolution_plotly_div
  Plotly string from metric evolution chart
grade_dict:
  Dictionary containing raw data in tables
  whose keys are the exam year and whose
  content are dictionaries containing
  quota-Plotly div pairs
#}

{# min_width was determined empirically #}
{% macro center(min_width='900px') %}
  <div class="row justify-content-center">
    <div class="col-md-12 col-lg-8 scroll-x">
      <div style="min-width: {{ min_width }};">
        {{ caller() }}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro table_title(title) %}
  <h2 class="mt-2 text-center">{{- title -}}<h2>
{% endmacro %}

{% block title %}{{ course_name }} - Manual do Vestibulando{% endblock title %}
{% block content %}

<main>
  {{ main_heading(course_name) }}
  {{ table_title('Valores das notas mais recentes') }}
  {# height was determined empirically #}
  {% call center() %}
    {{ latest_metrics_plotly_div }}
  {% endcall %}

  {{ table_title('Evolução dos valores com o passar dos anos') }}
  {% call center() %}
    {{ metric_evolution_plotly_div }}
  {% endcall %}
</main>

<h1 class="mt-5 text-center">Tabelas de Notas</h1>
<nav class="row">
  <div class="btn-group" role="group">
    {% for year in grade_dict.keys() | sort() %}
      <button
          type="button"
          class="btn {{ 'btn-primary' if loop.last else 'btn-outline-primary' -}}"
          data-bs-toggle="collapse"
          data-bs-target="#table{{- year -}}"
          aria-expanded="{{- 'true' if loop.last else 'false' -}}"
          aria-controls="{{- year -}}">
        {{- year -}}
      </button>
    {% endfor %}
  </div>
</nav>

{% for year, year_dict in grade_dict | dictsort() %}
  <section id="table{{- year -}}"
      class="collapse {{ 'show' if loop.last -}}">
    <h1 class="my-2">{{- year -}}</h1>
    {% for quota, plotly_table_div in year_dict | dictsort %}
      {{ table_title(quota) }}
      {# min_width was determined empirically #}
      {% call center(min_width='1300px') %}
        {{ plotly_table_div|safe }}
      {% endcall %}
    {% endfor %}
  </section>
{% endfor %}

{% endblock content %}
